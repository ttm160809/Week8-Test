import{a as u,s as _}from"./sweetAlertStore-Kox9lh_f.js";import{_ as g,o as d,b as c,d as e,t as r,j as h,l as b,s as T,f as v,m as C,r as f,e as $,F as w,k as E,n as L}from"./index-2QS3OBab.js";import{m as y}from"./modalMixin-8ctMqeDL.js";const V={props:{tempCoupon:{},updateCoupon:{},isNew:{}},data(){return{modal:null,editCoupon:{is_enabled:!1}}},methods:{switchDate(o){return new Date(o*1e3).toISOString().slice(0,10)}},watch:{tempCoupon(){this.editCoupon=this.tempCoupon}},emits:["update-coupon"],mixins:[y]},N={id:"couponModal",ref:"modal",class:"modal fade",tabindex:"-1","aria-labelledby":"couponModalLabel","aria-hidden":"true"},S={class:"modal-dialog modal-xl"},U={class:"modal-content border-0"},I={class:"modal-header bg-dark text-white"},A={id:"couponModalLabel",class:"modal-title"},R=e("button",{type:"button",class:"btn-close btn-close-white","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),B={class:"modal-body"},O={class:"row"},z={class:"row"},F={class:"mb-3 col-md-6"},j=e("label",{for:"title",class:"form-label"},"優惠券名稱",-1),P={class:"mb-3 col-md-6"},W=e("label",{for:"dueDate",class:"form-label"},"到期日",-1),q={class:"row"},G={class:"mb-3 col-md-6"},H=e("label",{for:"code",class:"form-label"},"優惠券代碼",-1),J={class:"mb-3 col-md-6"},K=e("label",{for:"percent",class:"form-label"},"優惠折扣",-1),Q=e("hr",null,null,-1),X={class:"mb-3"},Y={class:"form-check"},Z=e("label",{class:"form-check-label",for:"is_enabled"},"是否啟用",-1),ee={class:"modal-footer"},te=e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function oe(o,t,a,k,s,i){return d(),c("div",N,[e("div",S,[e("div",U,[e("div",I,[e("h5",A,[e("span",null,r(a.isNew?"新增優惠券":"編輯優惠券"),1)]),R]),e("div",B,[e("div",O,[e("div",z,[e("div",F,[j,h(e("input",{id:"title",type:"text",class:"form-control",placeholder:"請輸入優惠券名稱","onUpdate:modelValue":t[0]||(t[0]=n=>s.editCoupon.title=n)},null,512),[[b,s.editCoupon.title]])]),e("div",P,[W,h(e("input",{id:"dueDate",type:"date",class:"form-control",placeholder:"請輸入到期日","onUpdate:modelValue":t[1]||(t[1]=n=>s.editCoupon.due_date=n)},null,512),[[b,s.editCoupon.due_date]])])]),e("div",q,[e("div",G,[H,h(e("input",{id:"code",type:"text",class:"form-control",placeholder:"請輸入優惠券代碼","onUpdate:modelValue":t[2]||(t[2]=n=>s.editCoupon.code=n)},null,512),[[b,s.editCoupon.code]])]),e("div",J,[K,h(e("input",{id:"percent",type:"text",class:"form-control",placeholder:"請輸入優惠折扣","onUpdate:modelValue":t[3]||(t[3]=n=>s.editCoupon.percent=n)},null,512),[[b,s.editCoupon.percent]])])]),Q,e("div",X,[e("div",Y,[h(e("input",{id:"is_enabled",class:"form-check-input",type:"checkbox","true-value":1,"false-value":0,"onUpdate:modelValue":t[4]||(t[4]=n=>s.editCoupon.is_enabled=n)},null,512),[[T,s.editCoupon.is_enabled]]),Z])])])]),e("div",ee,[te,e("button",{type:"button",class:"btn btn-primary",onClick:t[5]||(t[5]=n=>o.$emit("update-coupon",o.editcoupon))}," 確認 ")])])])],512)}const se=g(V,[["render",oe]]),ne={props:{tempCoupon:{}},data(){return{modal:null}},emits:["delete-Coupon"],mixins:[y]},le={id:"delCouponModal",ref:"modal",class:"modal fade",tabindex:"-1","aria-labelledby":"delCouponModalLabel","aria-hidden":"true"},ae={class:"modal-dialog"},ie={class:"modal-content border-0"},de=e("div",{class:"modal-header bg-danger text-white"},[e("h5",{id:"delCouponModalLabel",class:"modal-title"},[e("span",null,"刪除優惠券")]),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),ce={class:"modal-body text-start"},pe=e("strong",{class:"text-danger"},null,-1),ue={class:"modal-footer"},re=e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function he(o,t,a,k,s,i){return d(),c("div",le,[e("div",ae,[e("div",ie,[de,e("div",ce,[v(" 是否刪除優惠券 "),pe,v(" "+r(a.tempCoupon.title)+" (刪除後將無法恢復)。 ",1)]),e("div",ue,[re,e("button",{type:"button",class:"btn btn-danger",onClick:t[0]||(t[0]=n=>o.$emit("delete-coupon"))}," 確認刪除 ")])])])],512)}const me=g(ne,[["render",he]]);var _e={VITE_URL:"https://vue3-course-api.hexschool.io",VITE_NAME:"eatburgertest",BASE_URL:"/Week8-Test/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:p,VITE_NAME:m}=_e,be=document.cookie.replace(/(?:(?:^|.*;\s*)hexToken\s*=\s*([^;]*).*$)|^.*$/,"$1");u.defaults.headers.common.Authorization=be;const Ce={data(){return{isLoading:!1,coupons:[],pages:{},isNew:!1,tempCoupon:{},timestamp:""}},methods:{...C(_,["swalError"]),...C(_,["checkError"]),...C(_,["successToast"]),...C(_,["errorToast"]),checkLogin(){this.isLoading=!0,u.post(`${p}/v2/api/user/check`).then(()=>{this.getCoupons()}).catch(()=>{this.$router.push("/login"),this.checkError()})},getCoupons(){u.get(`${p}/v2/api/${m}/admin/coupons`).then(o=>{this.coupons=o.data.coupons,this.timestamp=Math.floor(new Date().getTime()/1e3),this.isLoading=!1}).catch(()=>{this.swalError()})},openModal(o,t){o==="new"?(this.isNew=!0,this.tempCoupon={is_enabled:0},this.$refs.cModal.openModal()):o==="edit"?(this.isNew=!1,this.tempCoupon={...t},this.tempCoupon.due_date=this.switchDate(this.tempCoupon.due_date),this.$refs.cModal.openModal()):o==="del"&&(this.tempCoupon={...t},this.$refs.dModal.openModal())},updateCoupon(){let o="post",t="クポーンデータが作成されました",a=`${p}/v2/api/${m}/admin/coupon`;if(this.isNew===!1&&(o="put",t="アップデートしました",a=`${p}/v2/api/${m}/admin/coupon/${this.tempCoupon.id}`),this.tempCoupon.percent<=0||this.tempCoupon.percent>=101){alert("請輸入1~100內的數字");return}this.tempCoupon.percent=Number(this.tempCoupon.percent),this.tempCoupon.due_date=new Date(this.tempCoupon.due_date).getTime()/1e3,u[o](a,{data:this.tempCoupon}).then(()=>{this.$refs.cModal.hideModal(),this.getCoupons(),this.successToast(t)}).catch(()=>{this.errorToast("お手数ですが、もう一度やり直してください")})},deleteCoupon(){u.delete(`${p}/v2/api/${m}/admin/Coupon/${this.tempCoupon.id}`,{data:this.tempCoupon}).then(()=>{this.$refs.dModal.hideModal(),this.getCoupons(),this.successToast("クポーンが削除されました")}).catch(()=>{this.errorToast("お手数ですが、もう一度やり直してください")})},changeIsEnabled(o){this.tempCoupon={...o},this.tempCoupon.is_enabled=Math.abs(o.is_enabled-1),u.put(`${p}/v2/api/${m}/admin/coupon/${this.tempCoupon.id}`,{data:this.tempCoupon}).then(()=>{this.getCoupons(),this.tempCoupon.is_enabled===1?this.successToast("クポーンがアクティベートされました"):this.successToast("クポーンがインアクティブされました")}).catch(()=>{this.errorToast("お手数ですが、もう一度やり直してください")})},switchDate(o){return new Date(o*1e3).toISOString().slice(0,10)}},mounted(){this.checkLogin()},components:{CouponModal:se,DelCouponModal:me}},fe={class:"container p-3"},$e=e("h2",{class:"mb-2"},"優惠券列表",-1),ve={class:"text-end mt-4"},ge=e("i",{class:"bi bi-plus"},null,-1),ke={class:"table mt-4 align-middle"},Me=e("thead",{class:"table-primary"},[e("tr",{class:"my-2"},[e("th",null,"優惠券名稱"),e("th",null,"優惠券代碼"),e("th",null,"優惠折扣"),e("th",null,"到期日"),e("th",null,"是否啟用"),e("th")])],-1),we={class:"form-check form-switch"},ye=["checked","onChange"],xe={class:"form-check-label",for:"flexSwitchCheckDefault"},De={key:0,class:"text-success"},Te={key:1},Ee={class:"text-end"},Le={class:"btn-group me-4"},Ve=["onClick"],Ne=e("i",{class:"bi bi-pencil-fill mx-2"},null,-1),Se=[Ne],Ue=["onClick"],Ie=e("i",{class:"bi bi-trash3-fill mx-2"},null,-1),Ae=[Ie];function Re(o,t,a,k,s,i){const n=f("VLoading"),x=f("CouponModal"),D=f("DelCouponModal");return d(),c(w,null,[$(n,{active:s.isLoading},null,8,["active"]),e("div",fe,[$e,e("div",ve,[e("button",{class:"btn btn-primary",onClick:t[0]||(t[0]=l=>i.openModal("new"))},[ge,v(" 建立新優惠券 ")])]),e("table",ke,[Me,e("tbody",null,[(d(!0),c(w,null,E(s.coupons,l=>(d(),c("tr",{key:l.id},[e("td",null,r(l.title),1),e("td",null,r(l.code),1),e("td",null,r(l.percent)+" %",1),e("td",{class:L({"text-danger":l.due_date<=this.timestamp,"fw-bold":l.due_date<=this.timestamp})},r(i.switchDate(l.due_date)),3),e("td",null,[e("div",we,[e("input",{class:"form-check-input",type:"checkbox",id:"flexSwitchCheckDefault",checked:l.is_enabled,onChange:M=>i.changeIsEnabled(l)},null,40,ye),e("label",xe,[l.is_enabled?(d(),c("span",De,"啟用")):(d(),c("span",Te,"未啟用"))])])]),e("td",Ee,[e("div",Le,[e("button",{type:"button",class:"btn btn-change btn-sm py-2",onClick:M=>i.openModal("edit",l)},Se,8,Ve),e("button",{type:"button",class:"btn btn-danger btn-sm py-2",onClick:M=>i.openModal("del",l)},Ae,8,Ue)])])]))),128))])])]),$(x,{"temp-coupon":s.tempCoupon,onUpdateCoupon:i.updateCoupon,"is-new":s.isNew,ref:"cModal"},null,8,["temp-coupon","onUpdateCoupon","is-new"]),$(D,{"temp-coupon":s.tempCoupon,onDeleteCoupon:i.deleteCoupon,ref:"dModal"},null,8,["temp-coupon","onDeleteCoupon"])],64)}const Fe=g(Ce,[["render",Re]]);export{Fe as default};
