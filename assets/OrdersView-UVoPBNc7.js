import{a as h}from"./axios-L6U4YIEh.js";import{_ as v,o as l,b as a,d as t,t as o,q as E,F as $,k,j as L,s as T,f as y,m,r as b,e as f}from"./index-_6wmlSz6.js";import{s as g}from"./sweetAlertStore-FjvXzu2r.js";import{m as M}from"./modalMixin-q-RYEMiF.js";import{P as V}from"./PaginationCard-BGStxQEW.js";const P={props:{tempOrder:{type:Object,default(){return{}}}},data(){return{modal:null,create_at:"",status:{},editOrder:{}}},methods:{switchDate(d){const e=new Date(d*1e3);let c=`${e.getFullYear()}-`,p=`${e.getMonth()+1<10?`0${e.getMonth()+1}`:e.getMonth()+1}-`,s=`${e.getDate()<10?`0${e.getDate()}`:e.getDate()} `,i=`${e.getHours()<10?`0${e.getHours()}`:e.getHours()}:`,n=e.getMinutes()<10?`0${e.getMinutes()}`:e.getMinutes();return c+p+s+i+n}},watch:{tempOrder(){this.editOrder=this.tempOrder,this.create_at=this.switchDate(this.tempOrder.create_at)}},emits:["update-paid"],mixins:[M]},S={class:"modal fade",id:"orderModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal"},N={class:"modal-dialog modal-xl",role:"document"},I={class:"modal-content border-0"},U=t("div",{class:"modal-header bg-dark text-white"},[t("h5",{class:"modal-title",id:"exampleModalLabel"},[t("span",null,"訂單細節")]),t("button",{type:"button",class:"btn-close btn-close-white","data-bs-dismiss":"modal","aria-label":"Close"})],-1),A={class:"modal-body"},R={class:"row"},B={class:"col-md-4"},j=t("h3",null,"用戶資料",-1),q={class:"table"},F={key:0},H=t("th",{style:{width:"100px"}},"姓名",-1),Y=t("th",null,"Email",-1),z=t("th",null,"電話",-1),W=t("th",null,"地址",-1),G=t("th",null,"留言",-1),J={class:"col-md-8"},K=t("h3",null,"訂單細節",-1),Q={class:"table"},X=t("th",{style:{width:"100px"}},"訂單編號",-1),Z=t("th",null,"下單時間",-1),tt=t("th",null,"付款狀態",-1),et={key:0,class:"text-success"},st={key:1,class:"fw-bold text-danger"},dt=t("th",null,"總金額",-1),ot=t("h3",null,"選購商品",-1),lt={class:"table"},at=t("thead",null,[t("tr")],-1),nt={class:"text-end"},it={class:"d-flex justify-content-end"},rt={class:"form-check"},ct={class:"form-check-label",for:"flexCheckDefault"},ht={key:0},_t={key:1},ut={class:"modal-footer"},pt=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function mt(d,e,c,p,s,i){return l(),a("div",S,[t("div",N,[t("div",I,[U,t("div",A,[t("div",R,[t("div",B,[j,t("table",q,[s.editOrder.user?(l(),a("tbody",F,[t("tr",null,[H,t("td",null,o(s.editOrder.user.name),1)]),t("tr",null,[Y,t("td",null,o(s.editOrder.user.email),1)]),t("tr",null,[z,t("td",null,o(s.editOrder.user.tel),1)]),t("tr",null,[W,t("td",null,o(s.editOrder.user.address),1)]),t("tr",null,[G,t("td",null,o(s.editOrder.message),1)])])):E("",!0)])]),t("div",J,[K,t("table",Q,[t("tbody",null,[t("tr",null,[X,t("td",null,o(s.editOrder.id),1)]),t("tr",null,[Z,t("td",null,o(s.create_at),1)]),t("tr",null,[tt,t("td",null,[s.editOrder.is_paid?(l(),a("strong",et,"已付款")):(l(),a("span",st,"尚未付款"))])]),t("tr",null,[dt,t("td",null,o(s.editOrder.total),1)])])]),ot,t("table",lt,[at,t("tbody",null,[(l(!0),a($,null,k(s.editOrder.products,n=>(l(),a("tr",{key:n.id},[t("th",null,o(n.product.title),1),t("td",null,o(n.qty)+" / "+o(n.product.unit),1),t("td",nt,o(n.final_total),1)]))),128))])]),t("div",it,[t("div",rt,[L(t("input",{class:"form-check-input",type:"checkbox",value:"",id:"flexCheckDefault","onUpdate:modelValue":e[0]||(e[0]=n=>s.editOrder.is_paid=n)},null,512),[[T,s.editOrder.is_paid]]),t("label",ct,[s.editOrder.is_paid?(l(),a("span",ht,"已付款")):(l(),a("span",_t,"未付款"))])])])])])]),t("div",ut,[pt,t("button",{type:"button",class:"btn btn-primary",onClick:e[1]||(e[1]=n=>d.$emit("update-paid",this.paid))}," 確認 ")])])])],512)}const bt=v(P,[["render",mt]]),ft={props:{tempOrder:{}},data(){return{modal:null}},emits:["delete-Order"],mixins:[M]},gt={id:"delOrderModal",ref:"modal",class:"modal fade",tabindex:"-1","aria-labelledby":"delOrderModalLabel","aria-hidden":"true"},Ot={class:"modal-dialog"},$t={class:"modal-content border-0"},kt=t("div",{class:"modal-header bg-danger text-white"},[t("h5",{id:"delOrderModalLabel",class:"modal-title"},[t("span",null,"刪除產品")]),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),yt={class:"modal-body text-start"},vt=t("strong",{class:"text-danger"},null,-1),xt={class:"modal-footer"},Mt=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function wt(d,e,c,p,s,i){return l(),a("div",gt,[t("div",Ot,[t("div",$t,[kt,t("div",yt,[y(" 是否刪除訂單 "),vt,y(" "+o(c.tempOrder.id)+" (刪除後將無法恢復)。 ",1)]),t("div",xt,[Mt,t("button",{type:"button",class:"btn btn-danger",onClick:e[0]||(e[0]=n=>d.$emit("delete-order"))}," 確認刪除 ")])])])],512)}const Dt=v(ft,[["render",wt]]);var Ct={VITE_URL:"https://vue3-course-api.hexschool.io",VITE_NAME:"eatburgertest",BASE_URL:"/Week8-Test/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:u,VITE_NAME:O}=Ct,Et=document.cookie.replace(/(?:(?:^|.*;\s*)hexToken\s*=\s*([^;]*).*$)|^.*$/,"$1");h.defaults.headers.common.Authorization=Et;const Lt={data(){return{isLoading:!1,orders:[],pages:{},isNew:!1,tempOrder:{imagesUrl:[]}}},methods:{...m(g,["swalError"]),...m(g,["checkError"]),...m(g,["successToast"]),...m(g,["errorToast"]),checkLogin(){this.isLoading=!0,h.post(`${u}/v2/api/user/check`).then(()=>{this.getOrders()}).catch(()=>{this.$router.push("/login"),this.checkError()})},getOrders(d=1){h.get(`${u}/v2/api/${O}/admin/orders?page=${d}`).then(e=>{this.orders=e.data.orders,this.pages=e.data.pagination,this.isLoading=!1}).catch(()=>{this.swalError()})},openModal(d,e){d==="order"?(this.isNew=!1,this.tempOrder={...e},this.$refs.pModal.openModal()):d==="del"&&(this.tempOrder={...e},this.$refs.dModal.openModal())},updatePaid(){const d={is_paid:this.tempOrder.is_paid};h.put(`${u}/v2/api/${O}/admin/order/${this.tempOrder.id}`,{data:d}).then(()=>{this.$refs.pModal.hideModal(),this.getOrders(),this.successToast("アップデートしました")}).catch(()=>{this.errorToast("お手数ですが、もう一度やり直してください")})},deleteOrder(){h.delete(`${u}/v2/api/${O}/admin/order/${this.tempOrder.id}`,{data:this.tempOrder}).then(()=>{this.$refs.dModal.hideModal(),this.getOrders(),this.successToast("注文が削除されました")}).catch(()=>{this.errorToast("お手数ですが、もう一度やり直してください")})},switchDate(d){return new Date(d*1e3).toISOString().slice(0,10)},changeIspaid(d){this.tempOrder={...d},this.tempOrder.is_paid=!d.is_paid;const e={is_paid:this.tempOrder.is_paid};h.put(`${u}/v2/api/${O}/admin/order/${this.tempOrder.id}`,{data:e}).then(()=>{this.getOrders(),this.successToast("お支払い状況が変更されました")}).catch(()=>{this.errorToast("お手数ですが、もう一度やり直してください")})}},mounted(){this.checkLogin()},components:{PaginationCard:V,OrderModal:bt,DelOrderModal:Dt}},Tt={class:"container p-3"},Vt=t("h2",{class:"mb-2"},"訂單列表",-1),Pt=t("div",{class:"text-end mt-4"},null,-1),St={class:"table mt-4 align-middle"},Nt=t("thead",{class:"table-primary"},[t("tr",null,[t("th",null,"購買時間"),t("th",null,"Email"),t("th",null,"購買款項"),t("th",null,"總金額"),t("th",null,"是否付款"),t("th")])],-1),It={class:"list-unstyled"},Ut={class:"fw-bold text-danger"},At={class:"form-check form-switch"},Rt=["checked","onChange"],Bt={class:"form-check-label",for:"flexSwitchCheckDefault"},jt={key:0,class:"text-success"},qt={key:1,class:"fw-bold text-danger"},Ft={class:"text-end"},Ht={class:"btn-group me-4"},Yt=["onClick"],zt=t("i",{class:"bi bi-search mx-2"},null,-1),Wt=[zt],Gt=["onClick"],Jt=t("i",{class:"bi bi-trash3-fill mx-2"},null,-1),Kt=[Jt];function Qt(d,e,c,p,s,i){const n=b("VLoading"),x=b("PaginationCard"),w=b("OrderModal"),D=b("DelOrderModal");return l(),a($,null,[f(n,{active:s.isLoading},null,8,["active"]),t("div",Tt,[Vt,Pt,t("table",St,[Nt,t("tbody",null,[(l(!0),a($,null,k(s.orders,r=>(l(),a("tr",{key:r.id},[t("td",null,o(i.switchDate(r.create_at)),1),t("td",null,o(r.user.email),1),t("td",null,[t("ul",It,[(l(!0),a($,null,k(r.products,(_,C)=>(l(),a("li",{key:C},[t("span",Ut,o(_.qty)+" x",1),y(" "+o(_.product.title),1)]))),128))])]),t("td",null,o(r.total),1),t("td",null,[t("div",At,[t("input",{class:"form-check-input",type:"checkbox",id:"flexSwitchCheckDefault",checked:r.is_paid,onChange:_=>i.changeIspaid(r)},null,40,Rt),t("label",Bt,[r.is_paid?(l(),a("span",jt,"已付款")):(l(),a("span",qt,"未付款"))])])]),t("td",Ft,[t("div",Ht,[t("button",{type:"button",class:"btn btn-change btn-sm py-2",onClick:_=>i.openModal("order",r)},Wt,8,Yt),t("button",{type:"button",class:"btn btn-danger btn-sm py-2",onClick:_=>i.openModal("del",r)},Kt,8,Gt)])])]))),128))])]),f(x,{pages:s.pages,"get-orders":i.getOrders},null,8,["pages","get-orders"])]),f(w,{"temp-order":s.tempOrder,onUpdatePaid:i.updatePaid,switchdate:i.switchDate,ref:"pModal"},null,8,["temp-order","onUpdatePaid","switchdate"]),f(D,{"temp-order":s.tempOrder,onDeleteOrder:i.deleteOrder,ref:"dModal"},null,8,["temp-order","onDeleteOrder"])],64)}const de=v(Lt,[["render",Qt]]);export{de as default};
