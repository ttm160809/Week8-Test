import{a as p}from"./axios-L6U4YIEh.js";import{m as f,_ as x,o as i,b as d,d as t,t as _,j as r,l as u,F as k,k as w,s as T,f as U,r as v,e as y}from"./index-YvzYcdzE.js";import{s as g}from"./sweetAlertStore-oCM12oAM.js";import{m as V}from"./modalMixin-Q2OiWUKU.js";import{P as C}from"./PaginationCard-68LZZ4il.js";var I={VITE_URL:"https://vue3-course-api.hexschool.io",VITE_NAME:"eatburgertest",BASE_URL:"/Week8-Test/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:L,VITE_NAME:D}=I,N={props:{tempProduct:{},updateProduct:{},isNew:{},createImages:{}},data(){return{modal:null,editProduct:{}}},methods:{...f(g,["errorToast"]),uploadFile(){const l=this.$refs.fileInput.files[0],e=new FormData;e.append("file-to-upload",l),p.post(`${L}/v2/api/${D}/admin/upload`,e,{headers:{"Content-Type":"multipart/form-data"}}).then(a=>{this.editProduct.imageUrl=a.data.imageUrl}).catch(()=>{this.errorToast("お手数ですが、もう一度やり直してください")})}},watch:{tempProduct(){this.editProduct=this.tempProduct,this.$refs.fileInput.value=""}},emits:["update-product"],mixins:[V]},A={id:"productModal",ref:"modal",class:"modal fade",tabindex:"-1","aria-labelledby":"productModalLabel","aria-hidden":"true"},R={class:"modal-dialog modal-xl"},S={class:"modal-content border-0"},F={class:"modal-header bg-dark text-white"},B={id:"productModalLabel",class:"modal-title"},O=t("button",{type:"button",class:"btn-close btn-close-white","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),j={class:"modal-body"},W={class:"row"},z={class:"col-sm-4"},q={class:"mb-3"},G=t("label",{for:"imageUrl",class:"form-label"},"主要圖片",-1),H=["src"],J={class:"mb-3"},K=t("label",{for:"customFile",class:"form-label"},"或 上傳圖片",-1),Q=t("br",null,null,-1),X=t("h3",{class:"mb-3"},"次要圖片",-1),Y={key:0},Z={class:"mb-3"},tt=["for"],et=["id","onUpdate:modelValue"],st=t("div",null,null,-1),ot=["src"],lt=["onClick"],it={key:0},dt={key:1},nt=t("button",{class:"btn btn-outline-secondary btn-sm d-block w-100 disabled"}," 新增圖片 ",-1),ct=[nt],at={key:1},rt={class:"col-sm-8"},ut={class:"mb-3"},mt=t("label",{for:"title",class:"form-label"},"標題",-1),pt={class:"row"},ht={class:"mb-3 col-md-6"},_t=t("label",{for:"category",class:"form-label"},"分類",-1),bt={class:"mb-3 col-md-6"},ft=t("label",{for:"unit",class:"form-label"},"單位",-1),gt={class:"row"},Pt={class:"mb-3 col-md-6"},vt=t("label",{for:"origin_price",class:"form-label"},"原價",-1),yt={class:"mb-3 col-md-6"},kt=t("label",{for:"price",class:"form-label"},"售價",-1),Ut=t("hr",null,null,-1),xt={class:"mb-3"},Mt=t("label",{for:"description",class:"form-label"},"產品描述",-1),$t={class:"mb-3"},wt=t("label",{for:"content",class:"form-label"},"說明內容",-1),Vt={class:"mb-3"},Et={class:"form-check"},Tt=t("label",{class:"form-check-label",for:"is_enabled"},"是否啟用",-1),Ct={class:"modal-footer"},It=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function Lt(l,e,a,M,s,n){return i(),d("div",A,[t("div",R,[t("div",S,[t("div",F,[t("h5",B,[t("span",null,_(a.isNew?"新增商品":"編輯商品"),1)]),O]),t("div",j,[t("div",W,[t("div",z,[t("div",q,[G,r(t("input",{type:"text",class:"form-control",placeholder:"請輸入圖片連結","onUpdate:modelValue":e[0]||(e[0]=o=>s.editProduct.imageUrl=o)},null,512),[[u,s.editProduct.imageUrl]]),t("img",{class:"img-fluid",src:s.editProduct.imageUrl,alt:""},null,8,H)]),t("div",J,[K,t("input",{type:"file",id:"customFile",class:"form-control",ref:"fileInput",onChange:e[1]||(e[1]=(...o)=>n.uploadFile&&n.uploadFile(...o))},null,544)]),Q,X,Array.isArray(s.editProduct.imagesUrl)?(i(),d("div",Y,[(i(!0),d(k,null,w(s.editProduct.imagesUrl,(o,m)=>(i(),d("div",{key:m},[t("div",Z,[t("label",{for:"imagesUrl"+m,class:"form-label"},"圖片網址",8,tt),r(t("input",{id:"imagesUrl"+m,type:"text",class:"form-control",placeholder:"請輸入圖片連結","onUpdate:modelValue":P=>s.editProduct.imagesUrl[m]=P},null,8,et),[[u,s.editProduct.imagesUrl[m]]]),st,t("img",{class:"img-fluid",src:o},null,8,ot),t("button",{class:"btn btn-outline-danger btn-sm d-block w-100",onClick:P=>s.editProduct.imagesUrl.splice(m,1)}," 刪除圖片 ",8,lt)])]))),128)),!s.editProduct.imagesUrl.length||s.editProduct.imagesUrl[s.editProduct.imagesUrl.length-1]?(i(),d("div",it,[t("button",{class:"btn btn-outline-primary btn-sm d-block w-100",onClick:e[2]||(e[2]=o=>s.editProduct.imagesUrl.push(""))}," 新增圖片 ")])):(i(),d("div",dt,ct))])):(i(),d("div",at,[t("button",{class:"btn btn-outline-primary btn-sm d-block w-100",onClick:e[3]||(e[3]=(...o)=>a.createImages&&a.createImages(...o))}," 新增圖片 ")]))]),t("div",rt,[t("div",ut,[mt,r(t("input",{id:"title",type:"text",class:"form-control",placeholder:"請輸入標題","onUpdate:modelValue":e[4]||(e[4]=o=>s.editProduct.title=o)},null,512),[[u,s.editProduct.title]])]),t("div",pt,[t("div",ht,[_t,r(t("input",{id:"category",type:"text",class:"form-control",placeholder:"請輸入分類","onUpdate:modelValue":e[5]||(e[5]=o=>s.editProduct.category=o)},null,512),[[u,s.editProduct.category]])]),t("div",bt,[ft,r(t("input",{id:"unit",type:"text",class:"form-control",placeholder:"請輸入單位","onUpdate:modelValue":e[6]||(e[6]=o=>s.editProduct.unit=o)},null,512),[[u,s.editProduct.unit]])])]),t("div",gt,[t("div",Pt,[vt,r(t("input",{id:"origin_price",type:"number",min:"0",class:"form-control",placeholder:"請輸入原價","onUpdate:modelValue":e[7]||(e[7]=o=>s.editProduct.origin_price=o)},null,512),[[u,s.editProduct.origin_price]])]),t("div",yt,[kt,r(t("input",{id:"price",type:"number",min:"0",class:"form-control",placeholder:"請輸入售價","onUpdate:modelValue":e[8]||(e[8]=o=>s.editProduct.price=o)},null,512),[[u,s.editProduct.price]])])]),Ut,t("div",xt,[Mt,r(t("textarea",{id:"description",type:"text",class:"form-control",placeholder:"請輸入產品描述","onUpdate:modelValue":e[9]||(e[9]=o=>s.editProduct.description=o)},`
             `,512),[[u,s.editProduct.description]])]),t("div",$t,[wt,r(t("textarea",{id:"description",type:"text",class:"form-control",placeholder:"請輸入說明內容","onUpdate:modelValue":e[10]||(e[10]=o=>s.editProduct.content=o)},`
             `,512),[[u,s.editProduct.content]])]),t("div",Vt,[t("div",Et,[r(t("input",{id:"is_enabled",class:"form-check-input",type:"checkbox","true-value":1,"false-value":0,"onUpdate:modelValue":e[11]||(e[11]=o=>s.editProduct.is_enabled=o)},null,512),[[T,s.editProduct.is_enabled]]),Tt])])])])]),t("div",Ct,[It,t("button",{type:"button",class:"btn btn-primary",onClick:e[12]||(e[12]=o=>l.$emit("update-product",s.editProduct))}," 確認 ")])])])],512)}const Dt=x(N,[["render",Lt]]),Nt={props:{tempProduct:{}},data(){return{modal:null}},emits:["delete-product"],mixins:[V]},At={id:"delProductModal",ref:"modal",class:"modal fade",tabindex:"-1","aria-labelledby":"delProductModalLabel","aria-hidden":"true"},Rt={class:"modal-dialog"},St={class:"modal-content border-0"},Ft=t("div",{class:"modal-header bg-danger text-white"},[t("h5",{id:"delProductModalLabel",class:"modal-title"},[t("span",null,"刪除產品")]),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),Bt={class:"modal-body text-start"},Ot=t("strong",{class:"text-danger"},null,-1),jt={class:"modal-footer"},Wt=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function zt(l,e,a,M,s,n){return i(),d("div",At,[t("div",Rt,[t("div",St,[Ft,t("div",Bt,[U(" 是否刪除商品 "),Ot,U(" "+_(a.tempProduct.title)+" (刪除後將無法恢復)。 ",1)]),t("div",jt,[Wt,t("button",{type:"button",class:"btn btn-danger",onClick:e[0]||(e[0]=o=>l.$emit("delete-product"))}," 確認刪除 ")])])])],512)}const qt=x(Nt,[["render",zt]]);var Gt={VITE_URL:"https://vue3-course-api.hexschool.io",VITE_NAME:"eatburgertest",BASE_URL:"/Week8-Test/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:h,VITE_NAME:b}=Gt,Ht=document.cookie.replace(/(?:(?:^|.*;\s*)hexToken\s*=\s*([^;]*).*$)|^.*$/,"$1");p.defaults.headers.common.Authorization=Ht;const Jt={data(){return{isLoading:!1,products:[],pages:{},isNew:!1,tempProduct:{imagesUrl:[]}}},methods:{...f(g,["swalError"]),...f(g,["checkError"]),...f(g,["successToast"]),...f(g,["errorToast"]),checkLogin(){this.isLoading=!0,p.post(`${h}/v2/api/user/check`).then(()=>{this.getProducts()}).catch(()=>{this.$router.push("/login"),this.checkError()})},getProducts(l=1){p.get(`${h}/v2/api/${b}/admin/products?page=${l}`).then(e=>{this.products=e.data.products,this.pages=e.data.pagination,this.isLoading=!1}).catch(()=>{this.swalError()})},openModal(l,e){l==="new"?(this.isNew=!0,this.tempProduct={imagesUrl:[""]},this.$refs.pModal.openModal()):l==="edit"?(this.isNew=!1,this.tempProduct={...e},this.$refs.pModal.openModal()):l==="del"&&(this.tempProduct={...e},this.$refs.dModal.openModal())},updateProduct(){let l="post",e="商品データが作成されました",a=`${h}/v2/api/${b}/admin/product`;this.isNew===!1&&(l="put",e="アップデートしました",a=`${h}/v2/api/${b}/admin/product/${this.tempProduct.id}`),p[l](a,{data:this.tempProduct}).then(()=>{this.$refs.pModal.hideModal(),this.getProducts(),this.successToast(e)}).catch(()=>{this.errorToast("お手数ですが、もう一度やり直してください")})},deleteProduct(){p.delete(`${h}/v2/api/${b}/admin/product/${this.tempProduct.id}`,{data:this.tempProduct}).then(()=>{this.$refs.dModal.hideModal(),this.getProducts(),this.successToast("データが削除されました")}).catch(()=>{this.errorToast("お手数ですが、もう一度やり直してください")})},createImages(){this.tempProduct.imagesUrl=[],this.tempProduct.imagesUrl.push("")},changeIsEnabled(l){this.tempProduct={...l},this.tempProduct.is_enabled=!l.is_enabled,p.put(`${h}/v2/api/${b}/admin/product/${this.tempProduct.id}`,{data:this.tempProduct}).then(()=>{this.getProducts(),this.tempProduct.is_enabled===!0?this.successToast("商品がアクティベートされました"):this.successToast("商品がインアクティブされました")}).catch(()=>{this.errorToast("お手数ですが、もう一度やり直してください")})}},created(){this.checkLogin()},components:{PaginationCard:C,ProductsModal:Dt,DelModal:qt}},Kt={class:"container p-3"},Qt=t("h2",{class:"mb-2"},"商品列表",-1),Xt={class:"text-end mt-4"},Yt=t("i",{class:"bi bi-plus"},null,-1),Zt={class:"table mt-4 align-middle"},te=t("thead",{class:"table-primary"},[t("tr",{class:"my-2"},[t("th",null,"分類"),t("th",{width:"200"}," 圖像 "),t("th",null,"產品名稱"),t("th",null,"原價"),t("th",null,"售價"),t("th",null,"是否啟用"),t("th")])],-1),ee=["src"],se={class:"form-check form-switch"},oe=["checked","onChange"],le={class:"form-check-label",for:"flexSwitchCheckDefault"},ie={key:0,class:"text-success"},de={key:1},ne={class:"text-end"},ce={class:"btn-group me-4"},ae=["onClick"],re=t("i",{class:"bi bi-pencil-fill mx-2"},null,-1),ue=[re],me=["onClick"],pe=t("i",{class:"bi bi-trash3-fill mx-2"},null,-1),he=[pe];function _e(l,e,a,M,s,n){const o=v("VLoading"),m=v("PaginationCard"),P=v("ProductsModal"),E=v("DelModal");return i(),d(k,null,[y(o,{active:s.isLoading},null,8,["active"]),t("div",Kt,[Qt,t("div",Xt,[t("button",{class:"btn btn-primary",onClick:e[0]||(e[0]=c=>n.openModal("new"))},[Yt,U(" 建立新商品 ")])]),t("table",Zt,[te,t("tbody",null,[(i(!0),d(k,null,w(s.products,c=>(i(),d("tr",{key:c.id},[t("td",null,_(c.category),1),t("td",null,[t("img",{src:c.imageUrl,class:"card-img-top rounded-0",style:{"object-fit":"cover"},height:"120",alt:"..."},null,8,ee)]),t("td",null,_(c.title),1),t("td",null,_(c.origin_price),1),t("td",null,_(c.price),1),t("td",null,[t("div",se,[t("input",{class:"form-check-input",type:"checkbox",id:"flexSwitchCheckDefault",checked:c.is_enabled,onChange:$=>n.changeIsEnabled(c)},null,40,oe),t("label",le,[c.is_enabled?(i(),d("span",ie,"啟用")):(i(),d("span",de,"未啟用"))])])]),t("td",ne,[t("div",ce,[t("button",{type:"button",class:"btn btn-change btn-sm py-2",onClick:$=>n.openModal("edit",c)},ue,8,ae),t("button",{type:"button",class:"btn btn-danger btn-sm py-2",onClick:$=>n.openModal("del",c)},he,8,me)])])]))),128))])]),y(m,{pages:s.pages,"get-products":n.getProducts},null,8,["pages","get-products"])]),y(P,{"temp-product":s.tempProduct,onUpdateProduct:n.updateProduct,"is-new":s.isNew,"create-images":n.createImages,ref:"pModal"},null,8,["temp-product","onUpdateProduct","is-new","create-images"]),y(E,{"temp-product":s.tempProduct,onDeleteProduct:n.deleteProduct,ref:"dModal"},null,8,["temp-product","onDeleteProduct"])],64)}const ye=x(Jt,[["render",_e]]);export{ye as default};
